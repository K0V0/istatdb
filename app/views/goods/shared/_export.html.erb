<% 
    item_state = nil
    case is_param?(:manufacturer_filter)
        when "0"
            item_state = "len došetrené"
        when "1"
            item_state = "len nedošetrené"
        else
            item_state = "- bez obmedzenia -"  
    end

    item_time_filter = "- bez obmedzenia -"
    if is_param?(:search_datetime)
        p = params[:q]
        timestring = "#{p['created_at_gteq(1i)']}"
        time = DateTime.parse("#{p['created_at_gteq(1i)']}-#{p['created_at_gteq(2i)']}-#{p['created_at_gteq(3i)']}-#{p['created_at_gteq(4i)']}:#{p['created_at_gteq(5i)']}")
        item_time_start = time.strftime("%d %B %Y, %H:%M")
        item_time_end = DateTime.current.strftime("%d %B %Y, %H:%M")
        item_time_filter = "#{item_time_start} - #{item_time_end}"
    end
%>


<%
fields_to_export = [
    :ident,
    :description,
    :note,
    :uncomplete_reason,
    :uncomplete,
    { 
        local_taric: [
            :kncode,
            :description
        ] 
    }, 
    { 
        manufacturers: [
            :name
        ]
    },
    {
        impexpcompanies: [
            :company_name
        ]
    }, 
    {
        uoms: [
            :uom,
            :uom_multiplier,
            :type
        ]
    }
]

head = [
    ["Referencia alebo popis tovaru obsahuje: ", is_param?(:ident_or_description_cont)||is_param?(:ident_cont)],
    ["Popis tovaru obsahuje: ", is_param?(:description_cont)],
    ["Spravodajská jednotka: ", Impexpcompany.where(id: is_param?([:impexpcompany_filter])).pluck(:company_name)],
    ["Výrobcovia/Odberatelia: ", Manufacturer.where(id: is_param?([:manufacturer_filter])).pluck(:name)],
    ["Stav položky: ", item_state],
    ["Časové obdobie: ", item_time_filter]
]
%>

<%= render(
    'layouts/shared/export',
    fields_to_select: fields_to_export,
    head: head
) %>