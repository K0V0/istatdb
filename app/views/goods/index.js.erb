
// goods table
elem = $('#goods').children('tbody');

if (elem.length === 0 /*|| '<%= action_name %>' == 'administration'*/) {
	// if goods table sectione removed from document due item details showup,
	// or if administrative mode enables
	// recreate table
	$('section.item_details').remove();
	$('<%= j(render "goods/goodslist/goodslist") %>').appendTo('main');

} else {
	// no need to remove whole section, just replace lines
	elem.children('tr').remove();
	$('<%= j(render "goods/goodslist/item", items: @result) %>').appendTo(elem);
}

<% [:ident, :local_taric_kncode].each do |f| %>
	var par = $("#<%=j f.to_s %>_sort_link").parent();
	par.empty();
	$("<%=j render('layouts/sort_links', obj: @search, fields: [f], action: :search) %>").children('a').unwrap().appendTo(par);
<% end %>

$("#q_s").val('<%= params[:q][:s] if params.deep_has_key? :q, :s %>');

$('#total_goods_count').children('b').text('<%= @result.total_count %>');

$("#pagination").empty();
$("<%=j paginate @result, remote: true %>").appendTo("#pagination");

$("input[name=page]").val("<%=j @MEM.page %>");

// renders manufacturers select field - manufacturers list is selected based on client 
var parent = $('#q_manufacturer_filter').parent();
parent.children().remove();
$('<%= j(render "goods/goodslist/search_select_manufacturer") %>').appendTo(parent)

// updates href on new good button - important to preload form with values 
// from search fields
var new_good_href = $('<%= j(render "layouts/action_add_new", pars: [:ident, :description, :ident_or_description, :impexpcompany_filter, :manufacturer_filter]) %>').attr('href');
$('#new_good_from_search').attr('href', new_good_href);

// remove edit item buttons when going back from show item
$('#delete_good_from_search, #edit_good_from_search').remove();

$('#back_or_search').val('<%=j t(action_name == 'show' ? :back : :search) %>');

if ('<%= @administrative_mode %>' == 'true') {
	GOODS_ACTIONS.refresh();
}

$("#goods").fixHeader();