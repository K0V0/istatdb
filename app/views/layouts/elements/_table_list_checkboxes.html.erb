
<% 
# obj - passsed in AR object
obj_name = "#{obj.class.name.underscore}"

# coll - passed in collection to select from
coll_name = "#{coll.name.underscore}_ids"

# val_method - method to call on collection objects to get value
val_method = val_method || "id"

# text_method - method(s) to call on collection to get label(s) text
text_method = text_method || val_method

# this loads associations of passed in obj to match checked checkboxes later
associated_records = obj.send("#{coll.name.pluralize.underscore}")
# this checks for params hash to catch if unsaved 
pars = params.deep_has_key?(obj_name, coll_name) ? params[obj_name][coll_name] : []
%>

<div class="tablewrap">

	<table class="rows_colored with_efects checkboxes_list">

		<thead><tr><th></th></tr></thead>

		<tbody>

			<% coll.each do |c| %>

				<tr>

					<td>
						<%= check_box(
							obj_name,
							coll_name,
							{ 
								multiple: true,
								checked: (associated_records.exists?(id: c.id))||(pars.include?(c.id.to_s))
							},
							c.id,
							""
						) %>
					</td>

					<% if text_method.is_a? Array %>
						<% text_method.each do |l| %>
							<td>
								<%= label(
									obj_name,
									coll_name,
									c.send(l),
									value: c.id
								) %>
							</td>
						<% end %>
					<% else %>
						<td> 
							<%#= label(
								obj_name,
								coll_name,
								c.send(val_method),
								value: c.id
							) %>
						</td>
					<% end %>

				</tr>

			<% end %>

		</tbody>

		<tfoot><tr><th></th></tr></tfoot>

	</table>

</div>