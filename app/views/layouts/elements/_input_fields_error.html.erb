
<% 
	if defined? assoc
		#if associated
		object = assoc
		assoc_name = object.class.to_s.underscore
		regex = /^(#{assoc_name}_attributes|#{assoc_name.pluralize}_attributes)$/
		err_keys = obj.object.errors.keys.select { |k| k.to_s.match(regex) }
		parent_errs = err_keys.map { |k| obj.object.errors[k] }.flatten
	else
		# if straight model
		object = obj.object
		parent_errs = []
	end

	if object.respond_to? :errors
		obj_errs = object.errors
	else
		obj_errs = []
	end
%>

<% if (obj_errs.any?)||(parent_errs.any?) %>

	<div class="form_errors">

		<% fields.each do |field_name, opts| %>
			<% if obj_errs[field_name].any? %>
				<% errclass = "#{object.class.to_s.underscore}_#{field_name.to_s}" %>
				<span class="errormessage <%= errclass %>">
					<%= obj_errs[field_name].first %>
				</span>
			<% end %>
		<% end %>

		<% if parent_errs.any? %>
			<% parent_errs.each do |err| %>
				<span>
					  <%= err %>
				</span>
			<% end %>
		<% end %>

	</div>

<% end %>
