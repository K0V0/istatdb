<%
	### neni nastavena instance variable pri hladani cez jserb
	parent_object = instance_variable_get("@#{params[:source_controller]}")
	allow_new = @result.size > 0 ? "0" : "1"
	is_multiedit = false
	if params.has_key?(:multiedit)
		is_multiedit = params['multiedit'] == "true" ? true : false
	end

	template = new_form_has_one_select(
		obj: parent_object,
		coll: @result,
		text_method: get_fields_from_ransack_params,
		opts: get_opts_from_ransack_params,
		multiedit: is_multiedit
	)
%>

// search-select section (widget)
var mainElem = $(document).find("#<%= params[:window_id] %>");
// table body
var tBody = mainElem.find("div.tablewrap").children("table").children("tbody");
// table rows
var rows = tBody.children("tr");
// for later use remember ids (vals) of buttons to avoid duplicates on refresh
var checked_btns_vals = []

var alower = mainElem.find(".<%= params[:model] %>_allow_add_new");

mainElem.find('input[name=page_num]').val("<%= params[:page].to_s %>");

// let checked values be there
rows.each(function() {
	var radio_btn = $(this).children("td").children("input[type=radio]");

	if (radio_btn.is(":checked")) {
		checked_btns_vals.push(radio_btn.val());
		// highlighting stays on selected and untouchable rows on value
		// when it was selected bug fix
		$(this).children('td').children('label').stripTagsInside();
	} else {
		<% if action_name == "new_select_search" %>
			$(this).remove();
		<% end %>
	}
});

if (alower.data('user-choosed') === undefined) {
	var before_state = alower.is(':checked');
	if ("<%= allow_new %>" == "1") {
		alower.prop('checked', true);
	} else {
		alower.prop('checked', false);
	}
	var after_state = alower.is(':checked');
	// potrebne pre staticky js skript vypinajuci tabulku
	if (before_state != after_state) {
		alower.trigger('change');
	}
}

var results = jQuery.parseHTML("<%=j template.html_safe %>");

// remove duplicates from results set, only append not duplicated
$(results).each(function() {
	var radio_btn = $(this).children("td").children("input[type=radio]");

	if (checked_btns_vals.indexOf(radio_btn.val()) == -1) {
		tBody.append($(this));
	}
});





