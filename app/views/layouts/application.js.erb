var AN = "<%= an = action_name %>";
var CTRL = "<%= ctrl = controller_name %>";
var body = $(document).find('body');

var searchform_actions;
var searchform_add_button;
var searchform_edit_button;
var searchform_delete_button;

body.data('controller_name', CTRL);
body.data('action_name', AN);
body.children('main').children('article').attr('class', AN+' '+CTRL);
body.attr('class',  AN+' '+CTRL);

$(document).find('nav.pagination').empty();

JS.H.run('once');
JS.H.run('on_change');

<% if an=='index'||an=='show'||an=='search' %>

	window.history.pushState("", "", "<%= url_for(action: action_name)%>");

	searchform_actions = body.find('section.search_bar > form > div.searchform_fulscreen_fields > div.searchform_actions');

	searchform_add_button = searchform_actions.children('a.add_item_from_search');

	searchform_edit_button = searchform_actions.children('a.edit_item_from_search');

	searchform_delete_button = searchform_actions.children('a.delete_item_from_search');
	
	$('main > article').empty();
	
	var tiriri = (AN == "index")||(AN == "search");
	$('#back_or_search').val(
		tiriri ? t('search.submit') : t('actions.back')
	);

<% end %>

<% if an=='index'||an=='search' %>

	body.addClass('noscroll');
	searchform_edit_button.addClass('hidden');
	searchform_delete_button.addClass('hidden');

<% elsif an == 'show' %>
	
	searchform_edit_button
		.removeClass('hidden')
		.attr('href', '<%= url_for(action: :edit) %>');

	searchform_delete_button
		.removeClass('hidden')
		.attr('href', '<%= url_for(action: :delete) %>');

	$(document).find('nav.pagination').empty();

<% end %>

<% if content_for? :items_table %>

	$('<%=j yield(:items_table) %>').appendTo('main > article');

	$('<%=j render("layouts/base/pagination") %>').children().appendTo('nav.pagination');

<% end %>

<% if content_for? :show_content %>

	$('<%=j yield(:show_content) %>').appendTo('main > article');
	
<% end %>

<%= yield %>

